---
title: 《GPU常用数据》
author: DH Wang
date: 1000-01-01
category: TA
layout: post
---


# Title

shader文件的数据类型除了常见的float、int、vector、half、real之外还有一些自定义的数据类型在做一些复杂效果或庞大架构时也是会经常用到的。使用OpenGL时，有一个默认的FBO（全称是Framebuffer Object简称为FBO），绘制到这个FBO中的东西，是直接显示在显示器上。但是你还可以创建另外的FBO，绘制到其上面的东西默认是不会显示在显示器上的。你可以把这个另外创建的FBO和你的默认FBO中的一个Texture关联起来，即你绘制在另外创建的FBO上的东西，可以直接在默认FBO中Sampling。这个另外创建的FBO就相当于一块buffer或二维数组，你可以往里面放任何东西。
 


# GPU容器
在一些高级编程语言中经常会用到迭代器算法，对应在GPU编程中操作纹理或者buffer会非常方便。
比如在CPU端脚本计算出了一堆数据想丢进GPU中计算，但是Shader中并没像C#的List这样的容器这时候便可以使用Buffer来动态传输数据。因为这些数据在GPU上运行所以可以直接在Shader
和computeshader以及hlsl后缀的文件上直接运行。

下面演示个简单的例子：
C#:
```
 public ComputeShader computeShader;
    public Material material;

    ComputeBuffer mParticleDataBuffer;
    public int mParticleCount = 2000;
    int kernelId;

    struct ParticleData {
        public Vector3 pos;
        public Color color;
    }

    void Start() {
        //struct中一共7个float，size=28
        mParticleDataBuffer = new ComputeBuffer(mParticleCount, 28); 
        ParticleData[] particleDatas = new ParticleData[mParticleCount];
        mParticleDataBuffer.SetData(particleDatas);
        kernelId = computeShader.FindKernel("UpdateParticle");
    }

    void Update() {
        computeShader.SetBuffer(kernelId, "ParticleBuffer", mParticleDataBuffer);
        computeShader.SetFloat("Time", Time.time);
        computeShader.Dispatch(kernelId, mParticleCount / 100, mParticleCount / 100, 1);
        material.SetBuffer("_particleDataBuffer", mParticleDataBuffer);
    }

    void OnRenderObject() {
        material.SetPass(0);
        Graphics.DrawProceduralNow(MeshTopology.Points, mParticleCount);
    }

    void OnDestroy() {
        mParticleDataBuffer.Release();
        mParticleDataBuffer.Dispose();
    }
```
定义一个computeBuffer来传输数据这里相当于一个List容器，容器的数据类型和长度则是在初始化创建时定义ComputeBuffer(mParticleCount, 28)，第一个是数据长度后面可以再更改不过好像这样使用并不是很规范，但是可以这样使用。

# Texture2D & sampler2D

在渲染管线上做一些修改时如果申请了一个RTHandle那么在Shader中是可以直接拿到这个贴图资源的不过是以Textur2D的形式存在，一般在shader中如果要对纹理进行采样则是使用sampler2D配合tex2D函数采样，但是Texture2D则是使用Load函数来读取信息，如： 
 
```
sampler2D _DiffuseTex;
float4 color = tex2D(_DiffuseTex,uv);
```
 
```
Texture2D _TempRT;

float4 color = _TempRT.Load(int3(uv, 0));
```
