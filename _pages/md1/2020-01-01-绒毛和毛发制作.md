---
title: 《绒毛和毛发的制作》
author: DH Wang
date: 1000-01-01
category: TA
layout: post
---


一般来说短毛效果制作使用多pass，农药里面妲己的尾巴也是使用的多pass调节出来的效果很有光泽质感。长毛效果如一些羽毛或头发等基本是使用插片透贴的方式，但也涉及排序的问题不是很好处理所以往往需要结合不透的方式混合，当然也有一些透明渲染技术和不需要考虑排序但消耗却相对比较高，下面两种方式都是在移动端比较常用的。

![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/21/11/22/mix.png)

# 服装摇粒绒材质

摇粒绒服饰效果的特点主要是毛绒短且毛绒呈现较大颗粒状，光影变化（需添加次时代光影）比较柔和呈现相对通透的感觉，每一根毛绒受重力影响几乎可以不计。效果如下：


![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/21/11/22/fle.png)
 
阴影和Ao颜色不一样加上BaseColor图就会出现太脏的感觉，在美术看来干净的意思就是变化没那么多，颜色统一效果过渡柔和且适中，太脏是对比度加上饱和度共同产生的问题就是太暗并且饱和度特别低。

![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/21/11/22/dirty.png)

在调节过程中毛发边缘部分效果不是很好导致远距离出现较平的效果，尝试对边缘部分的长度进行动态控制即增大外扩强度。


关于顶点色部分可以使用该属性进行部分指定位置不进行绒毛外扩。

关于第一层是否受重力影响的问题，按常理来讲应该保持不动只让其他层进行变动，但由于毛发比较短所以重力几乎可以不计效果上让第一层跟随运动效果也可以接受，故保留该功能视情况而定。

细节法线部分没有采用细节法线贴图，考虑到会多一张贴图不方便制作和占用采样器故通过黑白图进行偏移模拟细节法线，但通过这样的方式会多三次采样可能会对性能造成一定影响。

关于Pass层数的考虑，由于毛发比较短所以在多Pass层数上可以做到小于12层的效果，代码中也保留了动态选择层数的功能，即当需要调整层数时可做到优化。

边缘光部分的计算也分了两种情况，即是否受到法线贴图的影响还是使用模型原始法线进行计算。关于使用法线贴图和细节法线部分计算边缘光，还可以单独使用一个变量控制边缘光受到法线贴图影响的强度大小，但发现使用模型原始法线视乎效果更好，不使用法线贴图也不会影响边缘处的光影变化而那么突兀。

该效果的光影变化比较柔和故采用ramp图来表现光照效果，当明暗交接处效果处理柔和适中时可以通过当前参数对ramp取横向数据制作色卡可减少贴图大小(前面的形状和遮罩贴图也可合并一张图不同通道)。

由于毛绒效果的毛发比较短所以走势也可以忽略不计即原始法线方向即可，但如果需要走向可以考虑沿着UV方向进行略微偏移，或者制作flowmap但成本比较高所以综合考量还是不进行走向偏移，但代码中保留了UV向的偏移效果。

涉及毛发类材质的光影表现比较麻烦，缺少了环境光遮蔽的效果会大打折扣，环境光遮蔽形成的散射是带有颜色的，会根据物体的颜色不同产生不同颜色。由于摇粒绒的特殊性其本身的通透感不是很强即不需要很强烈的次表面散射效果使用边缘光即可，但AO的颜色和阴影部分的颜色需要考虑到整体表现选择是否需要单独控制，两者若明显色彩饱和度和明度差异过大则会出现脏迹等不好的视觉效果。
 
制作过程尝试过增加环境光从上到下增加光照。计算散射颜色。边缘透明衰减使效果远近适合。片元中偏移毛发的走向沿UV四个方向加权取值，但毛发较短效果没出来。跟随视角远近拉伸绒毛长度。使用噪波函数对毛发进行扰乱，这个效果出来还可以但似乎并不是很必要故舍弃。


# 透贴插片

使用模型片来制作长毛需要使用导线插件，而且对贴图也有特殊需求进行处理，效果也直接和模型插片数相关，效果如下：

![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/21/11/22/al.png)

不管是多pass和插片这两种方式模拟毛发都是效果一般而且适合在短毛上模拟，Unity新推出的一个毛发解决方案倒是非常不错，在模拟长头发这种效果上非常出色，使用computeshader来计算导线位置并配合顶点着色器阶段直接绘制，在移动端上也可以取得不错的效果，不过官方的插件比较复杂看起挺头疼的所以并没有深入研究。
 
![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/21/11/22/hair.gif)
