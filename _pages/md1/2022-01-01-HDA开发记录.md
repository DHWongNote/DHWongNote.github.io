---
title: 《HDA开发记录》
author: DH Wang
date: 1000-01-01
category: TA
layout: post
---

# HDA开发记录

Houdini和Unity主要是围绕以HDA资产进行交互其中也包含了一些衍生工具和数据类型，如曲线和输入节点（可以当做HDA的数据输入从另一方面讲也可以当做子HDA来看待）。提供的功能除开直接创建和使用几何图形和材质纹理外还可以将场景转移到Houdini引擎中进行编辑，这里只简单介绍下以C#编程为主和Houdini提供的接口进行的交互示例。（注意不同版本可能会造成一定的编译错误，这里使用的环境是Houdini19.5.3和unity2021.3.2）


![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/22/11/8/1.png)

在Unity中有继承Object基类的GameObject在场景会被经常使用和操作，虚幻中也有从Actor派生出的一些常用的AI类和人物类等等，Houdini插件的接入主要是以HEU_HoudiniAsset为操作对象类，插件中很多数据都可以直接从该类中获取（包括数据类型，参数对象还有大量的引用关系等）。

无论是HDA资产或者曲线资产都是经过HEU_HoudiniAssetRoot进一步封装过后提供出来，直观的UI面板也是经过该类简化后（方便美术使用，尽管还是有很多美术觉得繁琐的功能）默认界面大致如下：


![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/22/11/8/2.png)

# 1、HDA设置参数

HDA中的控制参数是继承ScriptableObject的形式作为资产类型保存的，因为不了解导入HDA的参数可能有多少或命名（所有参数是以数组存放的在HEU_ParameterData类中）所以要修改参数可以使用内置提供的工具类修改：


![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/22/11/8/3.png)

# 2、本地HDA加载

![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/22/11/8/4.png)

因为HDA作为特殊的数据资源所以不能直接使用AssetDataBase加载，需要把加载出来的文件反序列化后才能正确读取所以使用内置提供的加载方法HEU_HAPIUtility.InstantiateHDA()。除了在该工具类（HEU_HAPIUtility）中加载HDA同时也可以调用里面的方法创建曲线和输入节点。

![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/22/11/8/5.png)

# 3、常用工具类

其实Houdini提供了很多对应主流引擎的插件在链接unity中做的一些封装用来二次开发也相对够用，如果不需要精确控制到里面具体每个方法的话只需在Asset层操作即可，若使用hda、节点、连接以及动态构建更复杂的网络或工具，则可用下面几个主流模块因为交互的资产无外乎材质、模型、贴图以及缓存数据，其中主要分为几个大的模块分别对应几何模型和材质以及一些通用的函数，如果不清楚具体用法可在官网查看，不过相信只要把这几个模块类方法大致浏览一番估计对该插件的了解也就差不多了。

![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/22/11/8/6.png)

# 4、测试用例及总结

在项目中我们给美术做了很多工具来提高工作效率，但美术在使用的时候需要把一些物体拖来拖去手动拖到场景中并配置输入。在这里为了减少美术使用工具的障碍（最理想的状态应该是让美术直观的操作自己想要的，因为是在unity中编辑所以不应该存在Houdini的一些操作）需要将一些操作用程序来实现，举个小例子：

默认导入工具后原生的UI参数面板提供了一些功能和按钮，但是美术关注点只在效果上，和效果直接相关的就是控制参数，所以剔除一些功能或者将一些功能用程序在后台执行。

![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/22/11/8/7.png)

除此还有个例子，通常由Houdini生成的HDA文件导入引擎后又分为三种类型（曲线资源、HDA资源、输入资源），如果想在引擎中创建曲线资源然后再衔接到其他HDA资源上需要先将曲线创建编辑后再找到HDA对应变量位置再手动拖拽建立引用关系，这里步骤就相对复杂和麻烦，经过简化后可以只在需要操作的HDA上修改曲线变量即可，如下：

![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/22/11/8/8.png)

![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/22/11/8/9.png)

对比上图即可看到简化后可大大提高美术在使用上的一些无用拖拽操作，大部分的工作由程序完成。


 大部分的操作基本上可在HEU_HoudiniAssetRoot、HEU_HoudiniAsset 、HEU_ParameterUtility这三个类中进行，如果需要开发或拓展新的工具链建议新建脚本使用工具类来构建，因为一些资源和方法都是通用的，详见官网网址：https://www.sidefx.com/docs/unity/index.html

 
![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/22/11/8/10.png)