---
title: 《marmoset各向异性丝绸》
author: DH Wang
date: 1000-01-01
category: TA
layout: post
---


# Title

一个好的布料系统可以给丝绸整体的效果加分不少，而现如今为了性能考虑，尤其是移动平台一般只有通过动作蒙皮后对衣服有些动态效果，好点的会有一些基于骨骼的布料系统，但是这样会使丝绸整体看起来很硬，感觉像一个壳，而不是衣服。基于顶点的布料物理，效果很好，但庞大的计算量一般只是离线渲染的专用，还有一种布料模拟运动的方式是VAT也就是在顶点着色阶段采样动画贴图，这种方式和顶点数和动画时长直接相关，使用Houdini可以很方便的模拟出该效果，并且Houdini也提供了对应的材质着色器（基本大多数引擎都有，这一点Houdini还是很强的）。


渲染部分为了增加布料丝绸质感 需要增加各向异性 高光效果，相关控制参数和八猴基本一致。效果如下：

![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/21/11/9/e.png)

光照计算部分的反射光并没有使用IBL（八猴中IBL获得较好的Sky反射效果），所以导致整体缺少一种磨砂的颗粒感整体呈现出一种透亮的感觉，反射部分采用的是两种模式二选一模拟环境反射（Cubemap/Matcap），推荐使用Cubemap！效果更好！需要注意的是可将Cubemap的贴图格式设置为Specular进行调节可获得较好的反射强度变化。

![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/21/11/9/p.png)

因为八猴也是开源的所以里面渲染部分的代码也是能直接获取到，美术效果基本是对照着八猴调节所以计算基本也是按照比例进行复刻其中各向异性高光强度-1到1，各向异性旋转方向和各向异性高光平移参数以及各向异性高光颜色控制和各向异性抖动参数也是一样的。


各向异性材质计算使用到了切线和副切线，切线贴图是为了解决接缝问题，因为各向异性高光部分会存在一个很明显的白线接缝（八猴里面的切线贴图叫做方向贴图也就是来引导高光走向避免造成突兀的白色接缝）。我这里实现方向贴图模式提供了两种选择（参考八猴源码/自定义旋转度数），自定义模式提供一个参数控制旋转角度。Scale$Bias和Swap X/Y Direction参数和八猴中一致即控制数值映射和翻转方向。而切线的方向对应模型的uv的u方向，副切线方向对应模型UV的V方向。


![](https://dhwblog-1301640854.cos.ap-chongqing.myqcloud.com/picture/img/21/11/9/dir.png)


补充一下丝绸的高光表现可以使用多层叠加来达到一个更丰富的效果，天刀里面的布料丝绸是个很值得参考的效果。