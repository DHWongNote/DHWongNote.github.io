---
title: 《事件和委托测试》
author: DH Wang
date: 1000-01-01
category: TA
layout: post
---

# 事件和委托

事件和委托简单用例,unity和虚幻也有自己的事件类而且封装相对完整，下面主要以unity为环境进行测试。
# 事件

## 创建事件和定义内部触发规则
```
public class MyCustomEvent : UnityEvent<int> { }
 
public class ProtectTest
{  
    private MyCustomEvent m_OnValueChanged = new MyCustomEvent();
    public MyCustomEvent onValueChanged { get { return m_OnValueChanged; } set { m_OnValueChanged = value; } }
 
    //触发事件（内部）
    public void CallEvent(int m_Value)
    { 
        m_OnValueChanged.Invoke(m_Value);
    }
}
```
触发时机由内部实现


## 触发测试事件
```
Class Test
{
    //目标执行函数
    void hairFunction(int m_Value)
    {
        print(m_Value);
    }


    public ProtectTest TestVar;

    //绑定监听函数
    public Test()
    {
        TestVar.onValueChanged.AddListener(hairFunction);
    }

    ////触发事件（外部）：通过事件调用内部函数，但事件一般不会用作该用途
    //public void CallEventFunc()
    //{ 
    //    TestVar.CallEvent(1);
    //    TestVar.CallEvent(2);
    //    TestVar.CallEvent(3);
    //}
}
```


## 虚幻输入按键绑定
类似虚幻输入绑定，很多操作都在内部的一些类中实现，结合下面的简单操作配合工程设置中的按键输入即可完成事件的绑定。
.h
```
class AUE4Fundamentals13Character : public ACharacter
{ 
protected: 
	virtual void SetupPlayerInputComponent(class UInputComponent* PlayerInputComponent) override;
}; 
```

.cpp
```
void ACustomCharacter::SetupPlayerInputComponent(class UInputComponent* PlayerInputComponent)
{ 
	check(PlayerInputComponent);

	PlayerInputComponent->BindAction("Jump", IE_Pressed, this, &ACharacter::Jump);
	PlayerInputComponent->BindAction("Jump", IE_Released, this, &ACharacter::StopJumping);

	PlayerInputComponent->BindAxis("MoveForward", this, &ACustomCharacter::MoveForward); 
	 
	PlayerInputComponent->BindTouch(IE_Pressed, this, &ACustomCharacter::TouchStarted); 
}
```
 


# 委托

## 1、创建并定义委托
```
public class RandomOne 
{  
    public void RandomAllCall()
    { 
        //Debug.Log("Hello World");
    }



    public void CallRandom()
    {
        applyrandom();
    }
    public event func applyrandom;
}
public delegate void func();
```



## 2、绑定委托函数对象
//创建函数指针，即GamePlay
```
RandomOne Handle = new RandomOne();
```

//创建实例1
```
RandomOne newrandom1 = new RandomOne();
Handle.applyrandom += newrandom1.RandomAllCall;
```

//创建实例1
```
RandomOne newrandom2 = new RandomOne();
Handle.applyrandom += newrandom2.RandomAllCall;
```



## 3、调用函数指针执行委托方法
当需要每个Random对象执行自身的委托方法则需要调用函数指针，如下：
```
Handle.CallRandom();
```
每个对象即可执行自身`HelloWorld`函数 