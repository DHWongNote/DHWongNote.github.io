---
title: 【UE Tip】UISlateNote
author: DH Wang
date:  1000-01-01
category: GAME
layout: post
---

S(Slate)  U(UMG)    
# https://docs.unrealengine.com/5.1/en-US/slate-ui-widget-examples-for-unreal-engine/

# HUD
运行时的UI元素绘制。常用流程：在初始模块中指定HUDClass的具体静态类（该类继承AHUD）,并在该类中重写DrawHUD即可。
```
//GameMode.cpp
/// use our custom HUD class
HUDClass = AMyHUD::StaticClass();

//AMyHUD.cpp 
void AMyHUD::DrawHUD()
{
	Super::DrawHUD(); 
	Canvas->DrawText(GEngine->GetSmallFont(), TEXT("Test string to be printed to screen"), 10, 10); //图片同理
}
```

# 获取当前场景中的HUD
当前关卡中默认设置的HUD Class和Actor的关系可通过 UGameplayStatics来获取
```
AMyHUD * hud = Cast<AMyHUD>(UGameplayStatics::GetPlayerController(this, 0)->GetHUD());
```

# HUD继承引用关系
HUD类->UserWidget类
HUD类：绘制逻辑和绘制时候，如调用DrawHUD等
UserWidget类：界面元素和用户数据，如文本元素，滑动条等


# 常用UI元素
//Slate按钮的委托函数必须要有返回值 FReply::Handled();
```
SNew(SButton)
.Text(FText::FromString(TEXT("DHBtn")))
.OnClicked_Lambda([this]()
{
    myint++;
    return FReply::Handled();	//必须有返回值
})
```

SNew(STextBlock)
.Text(FText::FromString(FString::FromInt(myint)))


标识符[]用来扩展类的内容，充当构造函数传参。示例中NomadTab后接参数即为新增参数。
```
const TSharedRef<SDockTab> NomadTab = SNew(SDockTab)
		.TabRole(ETabRole::NomadTab);

	return NomadTab;

	return SNew(SDockTab)
		.TabRole(ETabRole::NomadTab)
		[
			// Put your tab content here!
			SNew(SBox)
			.HAlign(HAlign_Center)
			.VAlign(VAlign_Center)
			[
				SNew(STextBlock)
				.Text(WidgetText)
			]
		];
```
    
# 绘制Slate文本变量，同理其他UI元素也一样 
TSharedPtr<STextBlock> TextBlock;
如果想在界面上绘制可变元素，需要使用共享指针，如果使用SNew(STextBlock)则只会绘制初始状态。
```
//使用前初始化共享指针
SAssignNew(EditorTextBlock, STextBlock).Text(
FText::FromString(FString::FromInt(myint))
);

//注册绘制
SHorizontalBox::Slot().FillWidth(1).HAlign(HAlign_Center).VAlign(VAlign_Center)
[
TextBlock.ToSharedRef()
]

//按钮修改
FReply ClickedOnButton()
{
myint++;  
if (EditorTextBlock.IsValid()) {
EditorTextBlock->SetText(FText::FromString(FString::FromInt((int32)(myint))));
} 
return FReply::Handled();
}
```
  
   
# UMG蓝图类
User Interface->Widget Blueprint(继承TestUI,而TestUI的父类是引擎UserWidget类)
父类（TestUI）根据按钮命名反射查找按钮实施监听

```
//.h 
#pragma once 
#include "CoreMinimal.h"
#include "Blueprint/UserWidget.h"
#include "TestUI.generated.h" 
DECLARE_DYNAMIC_MULTICAST_DELEGATE(FOnButtonClickedEventMantra); 
UCLASS()
class UNREAL_PLAYGROUND_API UTestUI : public UUserWidget
{
	GENERATED_BODY() 
public: 
	virtual void NativeConstruct() override; 
	UPROPERTY(Meta = (BindWidget))
	class UButton* Btn_Test;
	UFUNCTION()
		void OnBtn_Test();
};
//.cpp
#include "TestUI.h" 
#include "Components/ContentWidget.h"
#include "Components/Button.h"  
void UTestUI::NativeConstruct()
{
	Super::NativeConstruct();
	if (Btn_Test != nullptr)
	{
		// 绑定按钮点击事件
		Btn_Test->OnClicked.AddDynamic(this, &UTestUI::OnBtn_Test);
	} 
	UE_LOG(LogTemp, Warning, TEXT("NativeConstruct"));
} 
void UTestUI::OnBtn_Test()
{
	UE_LOG(LogTemp, Warning, TEXT("btn clicked"));
}
```